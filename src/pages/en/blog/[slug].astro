---
import { getCollection } from 'astro:content';
import MainLayout from '@/layouts/MainLayout.astro';
import BlogNavbar from '@/components/BlogNavbar';
import Footer from '@/components/Footer';
import { LANG, getI18N } from '@/i18n/index';
import { SITE_URL } from '@/constants';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const locale = LANG.ENGLISH;
const translations = getI18N({ currentLocale: locale });
const currentUrl = `${SITE_URL}/en/blog/${post.slug}`;
const title = `${post.data.title} | Blog RimoByte`;
const description = post.data.description;
const keywords = post.data.tags.join(', ');

const blogSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "author": {
    "@type": "Person",
    "name": post.data.author,
    "url": SITE_URL
  },
  "publisher": {
    "@type": "Organization",
    "name": "RimoByte",
    "url": SITE_URL
  },
  "datePublished": post.data.pubDate.toISOString(),
  "dateModified": post.data.pubDate.toISOString(),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": currentUrl
  },
  "url": currentUrl,
  "image": post.data.image || `${SITE_URL}/og-image.png`,
  "inLanguage": "en-US"
};
---

<MainLayout 
  title={title}
  description={description}
  keywords={keywords}
  locale={locale}
  canonical={currentUrl}
>
  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
  
  <BlogNavbar client:load currentLang={locale} />

  <main class="min-h-screen bg-gray-50 dark:bg-gray-900">
    
    <!-- Back link -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-4">
      <a href="/en/blog" class="inline-flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        Back to blog
      </a>
    </div>

    <article class="pb-20">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header -->
        <header class="mb-10 pb-8 border-b border-gray-200 dark:border-gray-700">
          <div class="flex flex-wrap gap-2 mb-6">
            {post.data.tags.map((tag) => (
              <span class="px-2.5 py-0.5 text-xs font-medium uppercase tracking-wider bg-blue-50 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/30 rounded-full text-blue-600 dark:text-blue-400">
                {tag}
              </span>
            ))}
          </div>
          
          <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
            {post.data.title}
          </h1>

          <p class="text-lg text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">
            {post.data.description}
          </p>
          
          <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-500">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full p-[2px] bg-gradient-to-r from-blue-500 to-purple-500 flex-shrink-0">
                <img src="/assets/images/programadora-web.webp" alt={post.data.author} class="w-full h-full rounded-full object-cover" width="32" height="32" loading="lazy" />
              </div>
              <span class="text-gray-700 dark:text-gray-300 font-medium">{post.data.author}</span>
            </div>
            <span class="text-gray-300 dark:text-gray-600">â€¢</span>
            <time datetime={post.data.pubDate.toISOString()}>
              {new Date(post.data.pubDate).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
          </div>
        </header>

        <!-- Article body -->
        <div class="blog-content prose prose-lg max-w-none
          prose-gray dark:prose-invert
        ">
          <Content />
        </div>

        <!-- CTA footer -->
        <footer class="mt-16 pt-10 border-t border-gray-200 dark:border-gray-700">
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-10 border border-gray-200 dark:border-gray-700 text-center">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">Did you find this useful?</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-8">If you have questions or need help with your project, let's talk.</p>
            <a 
              href="https://wa.me/34684713743?text=Hi,%20I'm%20coming%20from%20the%20RimoByte%20blog"
              class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-bold text-lg hover:from-blue-600 hover:to-purple-600 transform hover:scale-105 transition-all duration-300"
            >
              Contact via WhatsApp
            </a>
          </div>
        </footer>

      </div>
    </article>
  </main>

  <Footer client:load translations={translations} />
</MainLayout>

<style is:global>
  /* ---- Blog typography: Light + Dark ---- */

  .blog-content h1 { display: none; }

  .blog-content h2 {
    font-size: 1.75rem;
    margin-top: 2.5rem;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
    letter-spacing: -0.01em;
  }
  .dark .blog-content h2 {
    border-bottom-color: #374151;
  }

  .blog-content h3 {
    font-size: 1.35rem;
    margin-top: 2rem;
    margin-bottom: 0.5rem;
  }

  .blog-content p {
    line-height: 1.8;
    margin-bottom: 1.25rem;
  }

  .blog-content ul,
  .blog-content ol {
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .blog-content li {
    margin-bottom: 0.35rem;
    line-height: 1.7;
  }
  .blog-content li::marker {
    color: #3b82f6;
  }

  .blog-content p > strong:only-child {
    display: block;
    margin-top: 1.25rem;
    margin-bottom: 0.25rem;
    font-size: 1.05rem;
    color: #7c3aed;
  }
  .dark .blog-content p > strong:only-child {
    color: #c4b5fd;
  }

  .blog-content a {
    color: #2563eb;
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
  }
  .blog-content a:hover {
    border-bottom-color: currentColor;
  }
  .dark .blog-content a {
    color: #60a5fa;
  }

  .blog-content code:not(pre code) {
    background: #f1f5f9;
    padding: 0.15rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    color: #6366f1;
  }
  .dark .blog-content code:not(pre code) {
    background: rgba(30, 41, 59, 0.8);
    color: #60a5fa;
  }

  .blog-content pre {
    background: #1e293b !important;
    border: 1px solid #334155;
    border-radius: 0.75rem;
    padding: 1.25rem;
  }

  .blog-content blockquote {
    border-left: 3px solid #3b82f6;
    background: #eff6ff;
    padding: 1rem 1.25rem;
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: normal;
  }
  .dark .blog-content blockquote {
    background: rgba(59, 130, 246, 0.05);
  }

  .blog-content hr {
    border-color: #e5e7eb;
    margin: 2.5rem 0;
  }
  .dark .blog-content hr {
    border-color: #374151;
  }

  /* Tables */
  .blog-content table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 1.5rem 0;
    border-radius: 0.75rem;
    overflow: hidden;
    border: 1px solid #e5e7eb;
    font-size: 0.9rem;
  }
  .dark .blog-content table {
    border-color: #334155;
  }
  .blog-content thead {
    background: #f8fafc;
  }
  .dark .blog-content thead {
    background: #334155;
  }
  .blog-content th {
    text-align: left;
    padding: 0.75rem 1rem;
    font-weight: 600;
    color: #111827;
    border-bottom: 2px solid #e5e7eb;
  }
  .dark .blog-content th {
    color: #f9fafb !important;
    border-bottom-color: #475569;
  }
  .blog-content td {
    padding: 0.65rem 1rem;
    border-bottom: 1px solid #f3f4f6;
    color: #374151;
  }
  .dark .blog-content td {
    border-bottom-color: #334155;
    color: #d1d5db !important;
  }
  .dark .blog-content td strong {
    color: #f3f4f6 !important;
  }
  .blog-content tbody tr:last-child td {
    border-bottom: none;
  }
  .blog-content tbody tr:hover {
    background: #f9fafb;
  }
  .dark .blog-content tbody tr:hover {
    background: #334155;
  }

  .blog-content img {
    border-radius: 0.75rem;
    border: 1px solid #e5e7eb;
  }
  .dark .blog-content img {
    border-color: #1e293b;
  }
</style>
